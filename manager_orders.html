<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏ - Volt Logistics</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            font-family: 'TT Runs Trial', Arial, sans-serif;
            margin: 0;
            padding: 0;
            padding-bottom: 150px; /* Increased bottom padding to 150px for better separation */
            background: #141414;
            color: white;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #FF6B35 0%, #E74C3C 100%);
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(255, 107, 53, 0.3);
        }

        .header h1 {
            margin: 0;
            font-size: 24px;
            font-weight: bold;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .filter-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-select {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid #555;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
        }

        .filter-select option {
            background: #333;
            color: white;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #00DBFF;
        }

        .stat-label {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }

        .orders-table {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
        }

        .table-header {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            display: grid;
            grid-template-columns: 1fr 150px 100px 80px 100px 200px;
            gap: 15px;
            font-weight: bold;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .order-row {
            padding: 15px;
            display: grid;
            grid-template-columns: 1fr 150px 100px 80px 100px 200px;
            gap: 15px;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: background 0.2s ease;
        }

        .order-row:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .order-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
            text-align: left;
        }

        .order-id {
            font-weight: bold;
            color: #00DBFF;
            cursor: pointer;
        }

        .order-id:hover {
            text-decoration: underline;
        }

        .order-user {
            font-size: 14px;
            color: #ccc;
        }

        .order-items {
            font-size: 12px;
            color: #888;
        }

        .items-count,
        .photos-count {
            font-weight: bold;
            text-align: center;
            padding: 5px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            min-width: 60px;
        }

        .items-count {
            color: #00DBFF;
        }

        .photos-count {
            color: #FF6B35;
        }

        .status-select {
            background: var(--status-color);
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            font-weight: bold;
        }

        .status-select:hover {
            opacity: 0.8;
        }

        .date-cell {
            font-size: 12px;
            color: #ccc;
        }

        .actions {
            display: flex;
            gap: 5px;
        }

        .action-btn {
            background: #00DBFF;
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
            margin-right: 8px;
            white-space: nowrap;
            box-shadow: 0 2px 4px rgba(0, 219, 255, 0.2);
        }

        .action-btn:hover {
            background: #00B8E6;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 219, 255, 0.3);
        }

        .action-btn.danger {
            background: #E74C3C;
        }

        .action-btn.danger:hover {
            background: #C0392B;
        }

        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ */
        .simple-button,
        .save-btn,
        .close-btn,
        .delete-photo-btn,
        .delete-report-btn {
            background: #00DBFF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 219, 255, 0.2);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .simple-button:hover,
        .save-btn:hover,
        .close-btn:hover {
            background: #00B8E6;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 219, 255, 0.3);
        }

        /* –ö–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è */
        .delete-photo-btn,
        .delete-report-btn {
            background: #E74C3C;
            padding: 6px 12px;
            font-size: 12px;
            margin: 2px;
        }

        .delete-photo-btn:hover,
        .delete-report-btn:hover {
            background: #C0392B;
            transform: translateY(-1px);
        }

        /* –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è */
        .save-btn {
            background: #34C759;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: bold;
        }

        .save-btn:hover {
            background: #2ECC71;
        }

        /* –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
        .close-btn {
            background: none;
            border: none;
            color: #888;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: none;
            box-shadow: none;
        }

        /* –°—Ç–∏–ª–∏ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" */
        .stylish-back-button {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 219, 255, 0.9);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0, 219, 255, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .stylish-back-button:hover {
            background: rgba(0, 185, 230, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 219, 255, 0.4);
        }

        .stylish-back-button:active {
            transform: translateY(0);
        }

        .stylish-back-button.show {
            opacity: 1;
            visibility: visible;
        }

        /* –§–æ—Ç–æ–æ—Ç—á–µ—Ç—ã */
        .photo-preview {
            transition: all 0.3s ease;
        }

        .photo-preview:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .photo-modal-content {
            background: #2a2a2a;
            margin: 5% auto;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            text-align: center;
        }

        .photo-modal-content img {
            max-width: 100%;
            max-height: 70vh;
            object-fit: contain;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
        .simple-button:active,
        .save-btn:active,
        .delete-photo-btn:active,
        .delete-report-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 219, 255, 0.2);
        }

        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π */
        .action-btn {
            white-space: nowrap;
            min-width: auto;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
        }

        .modal-content {
            background: #2a2a2a;
            margin: 5% auto;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #555;
        }

        .close-btn {
            background: none;
            border: none;
            color: #888;
            font-size: 24px;
            cursor: pointer;
        }

        .close-btn:hover {
            color: white;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            color: #ccc;
            font-size: 14px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid #555;
            padding: 10px;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #00DBFF;
        }

        .save-btn {
            background: #34C759;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }

        .save-btn:hover {
            background: #2ECC71;
        }

        /* –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ */
        .simple-button,
        .save-btn,
        .delete-photo-btn,
        .delete-report-btn,
        .action-btn,
        .back-btn,
        .stylish-back-button {
            background: #00DBFF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 219, 255, 0.2);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: 'TT Runs', Arial, sans-serif;
            min-height: 44px;
            position: relative;
            overflow: hidden;
        }

        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–Ω–æ–ø–æ–∫ */
        .save-btn {
            background: #28a745 !important;
        }

        .delete-photo-btn,
        .delete-report-btn {
            background: #dc3545 !important;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.1) !important;
        }

        /* Hover —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ */
        .simple-button:hover,
        .action-btn:hover,
        .stylish-back-button:hover {
            background: #00B8E6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 219, 255, 0.4);
        }

        .save-btn:hover {
            background: #218838 !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
        }

        .delete-photo-btn:hover,
        .delete-report-btn:hover {
            background: #c82333 !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2) !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.2);
        }

        /* Active —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ */
        .simple-button:active,
        .save-btn:active,
        .delete-photo-btn:active,
        .delete-report-btn:active,
        .action-btn:active,
        .back-btn:active,
        .stylish-back-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
        .simple-button:before,
        .action-btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .simple-button:hover:before,
        .action-btn:hover:before {
            left: 100%;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ */
        .modal-button,
        .close-btn {
            background: #00DBFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
            font-family: 'TT Runs', Arial, sans-serif;
        }

        .close-btn {
            background: #dc3545;
            padding: 8px 12px;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            line-height: 1;
        }

        .close-btn:hover {
            background: #c82333;
            transform: scale(1.1);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #888;
        }

        .error {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid #E74C3C;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ç–æ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ */
        .photo-preview {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            border: 2px solid #00DBFF;
            position: relative;
        }

        .photo-preview:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }

        .photos-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .photo-item {
            position: relative;
            display: inline-block;
        }

        .photo-actions {
            position: absolute;
            top: -5px;
            right: -5px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .photo-item:hover .photo-actions {
            opacity: 1;
        }

        .photo-action-btn {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .photo-action-btn:hover {
            background: #00DBFF;
            transform: scale(1.1);
        }

        .photo-action-btn.download {
            background: rgba(52, 199, 89, 0.9);
        }

        .photo-action-btn.download:hover {
            background: #34C759;
        }

        .photo-action-btn.enhance {
            background: rgba(255, 107, 53, 0.9);
        }

        .photo-action-btn.enhance:hover {
            background: #FF6B35;
        }

        .photo-modal-content {
            background: #2a2a2a;
            margin: 5% auto;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 900px;
            text-align: center;
        }

        .photo-modal-content img {
            max-width: 100%;
            max-height: 60vh;
            object-fit: contain;
            border-radius: 8px;
        }

        .photo-modal-actions {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .enhance-controls {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .enhance-slider {
            width: 100%;
            margin: 10px 0;
            -webkit-appearance: none;
            height: 5px;
            border-radius: 5px;
            background: #555;
            outline: none;
        }

        .enhance-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #00DBFF;
            cursor: pointer;
        }

        .enhance-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #00DBFF;
            cursor: pointer;
            border: none;
        }

        .enhance-preview {
            display: flex;
            gap: 20px;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .enhance-preview img {
            max-width: 300px;
            max-height: 300px;
            border-radius: 8px;
            border: 2px solid #555;
        }

        .enhance-preview .original {
            border-color: #888;
        }

        .enhance-preview .enhanced {
            border-color: #00DBFF;
        }

        .enhance-label {
            text-align: center;
            margin-bottom: 10px;
            color: #ccc;
            font-size: 14px;
        }

        @media (max-width: 768px) {

            .table-header,
            .order-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .actions {
                flex-direction: column;
                gap: 8px;
            }

            .action-btn {
                width: 100%;
                padding: 12px;
                font-size: 16px;
            }
        }

        /* SVG Back Button Styles */
        .svg-back-button {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: none;
            border: none;
            padding: 0;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
            opacity: 1;
            visibility: visible;
        }

        .svg-back-button.show {
            opacity: 1;
            visibility: visible;
        }

        .svg-back-button:hover {
            transform: translateX(-50%) translateY(-4px);
            filter: brightness(1.1);
        }

        .svg-back-button:active {
            transform: translateX(-50%) translateY(-2px);
        }

        .back-button-svg {
            width: 180px;
            height: auto;
            filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.4));
            transition: all 0.3s ease;
        }

        .svg-back-button:hover .back-button-svg {
            filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.5)) brightness(1.1);
        }
    </style>
    <script src="js/common.js"></script>
    <script src="js/manager_orders.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

</head>

<body>
    <div class="page-container">
        <div class="page-header">
            <h1 class="page-title">üë®‚Äçüíº –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏</h1>
            <p class="page-subtitle">–ü–∞–Ω–µ–ª—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ–º–∏ –∑–∞–∫–∞–∑–∞–º–∏</p>
        </div>

        <div class="content-section">
            <div
                style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center; justify-content: space-between;">
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <select class="simple-input" id="statusFilter" onchange="filterOrders()"
                        style="width: auto; min-width: 150px;">
                        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                    </select>
                    <select class="simple-input" id="userFilter" onchange="filterOrders()"
                        style="width: auto; min-width: 150px;">
                        <option value="">–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</option>
                    </select>
                </div>
                <button class="simple-button" onclick="loadAllOrders()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
        </div>

        <div class="stats" id="statsContainer">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</div>
        </div>

        <div class="orders-table">
            <div class="table-header">
                <div>–ó–∞–∫–∞–∑ / –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                <div>–°—Ç–∞—Ç—É—Å</div>
                <div>–°–æ–∑–¥–∞–Ω</div>
                <div>–¢–æ–≤–∞—Ä–æ–≤</div>
                <div>–û–±–Ω–æ–≤–ª–µ–Ω</div>
                <div>–î–µ–π—Å—Ç–≤–∏—è</div>
            </div>
            <div id="ordersContainer">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...</div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h3>
                <button class="close-btn" onclick="closeEditModal()">&times;</button>
            </div>
            <div id="editForm">
                <!-- –§–æ—Ä–º–∞ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <script>
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω—ã –≤ manager_orders.js
        // let allOrders = [];
        // let filteredOrders = [];
        // let orderStatuses = {};
        // let currentEditOrder = null;

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤
        async function loadOrderStatuses() {
            try {
                const response = await fetch('http://localhost:5000/api/orders/statuses');
                const data = await response.json();

                if (data.status === 'success') {
                    data.statuses.forEach(status => {
                        orderStatuses[status.id] = status;
                    });

                    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä —Å—Ç–∞—Ç—É—Å–æ–≤
                    const statusFilter = document.getElementById('statusFilter');
                    data.statuses.forEach(status => {
                        const option = document.createElement('option');
                        option.value = status.id;
                        option.textContent = status.name;
                        statusFilter.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –∑–∞–∫–∞–∑—ã
        async function loadAllOrders() {
            console.log('–ù–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤');
            const container = document.getElementById('ordersContainer');
            container.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...</div>';

            try {
                console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ API: http://localhost:5000/api/orders/all');
                const response = await fetch('http://localhost:5000/api/orders/all');
                console.log('–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç API, —Å—Ç–∞—Ç—É—Å:', response.status);
                const data = await response.json();
                console.log('–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', data);

                if (data.status === 'success') {
                    console.log('–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã:', data.orders);
                    // –î–æ–±–∞–≤–ª—è–µ–º ID –∑–∞–∫–∞–∑–∞ –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
                    allOrders = data.orders.map(order => {
                        console.log('–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–∞:', order);
                        // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ —É –∑–∞–∫–∞–∑–∞ –µ—Å—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è
                        const processedOrder = {
                            ...order,
                            id: order.id || 'unknown',
                            status: order.status || 'pending_check',
                            created_at: order.created_at || new Date().toISOString(),
                            status_updated_at: order.status_updated_at || new Date().toISOString()
                        };
                        console.log('–û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –∑–∞–∫–∞–∑:', processedOrder);
                        return processedOrder;
                    });
                    filteredOrders = [...allOrders];
                    console.log('–í—Å–µ –∑–∞–∫–∞–∑—ã:', allOrders);
                    displayOrders();
                    updateStats();
                    updateUserFilter();

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞
                    if (allOrders.length > 0) {
                        const firstOrder = allOrders[0];
                        if (firstOrder.items && firstOrder.items.some(item => item.photos && item.photos.length > 0)) {
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –≤ –∑–∞–∫–∞–∑–∞—Ö
                            const ordersWithPhotos = allOrders.filter(order =>
                                order.items && order.items.some(item => item.photos && item.photos.length > 0)
                            );

                            if (ordersWithPhotos.length > 0) {
                                console.log('–ù–∞–π–¥–µ–Ω—ã –∑–∞–∫–∞–∑—ã —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏:', ordersWithPhotos.length);
                            }
                        }
                    }
                } else {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤:', data.message);
                    showError(data.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤:', error);
                showError('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 5000.');
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∑–∞–∫–∞–∑—ã
        function displayOrders() {
            const container = document.getElementById('ordersContainer');

            if (filteredOrders.length === 0) {
                container.innerHTML = '<div class="loading">–ó–∞–∫–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }

            console.log('–û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∑–∞–∫–∞–∑—ã:', filteredOrders);
            const ordersHTML = filteredOrders.map(order => {
                console.log('–°–æ–∑–¥–∞–µ–º —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–∫–∞–∑–∞:', order);
                return createOrderRow(order);
            }).join('');
            container.innerHTML = ordersHTML;
        }

        // –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä–æ–∫—É –∑–∞–∫–∞–∑–∞
        function createOrderRow(order) {
            const status = orderStatuses[order.status] || { name: order.status, color: '#888' };
            const createdDate = new Date(order.created_at).toLocaleDateString('ru-RU');
            const updatedDate = new Date(order.status_updated_at).toLocaleDateString('ru-RU');

            // –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
            const itemsCount = order.total_items || (order.items && order.items.length) || 0;
            const photosCount = order.total_photos || (order.items ? order.items.reduce((sum, item) => sum + (item.photos ? item.photos.length : 0), 0) : 0);

            return `
                <div class="order-row">
                    <div class="order-info">
                        <div class="order-id" onclick="showOrderDetails('${order.id}')">
                            ${order.order_number ? `#${order.order_number}` : `ID: ${order.id}`}
                        </div>
                        ${!order.order_number ? `<div class="order-full-id" style="font-size: 10px; color: #666;">
                            ID: ${order.id}
                        </div>` : ''}
                        <div class="order-user">
                            üë§ ${order.full_name || order.telegram_username || '–ë–µ–∑ –∏–º–µ–Ω–∏'}
                        </div>
                        <div class="order-items" style="display: flex; flex-direction: column; gap: 5px;">
                            <div>üì¶ ${itemsCount} —Ç–æ–≤–∞—Ä–æ–≤</div>
                            <div>üì∑ ${photosCount} —Ñ–æ—Ç–æ</div>
                        </div>
                    </div>
                    <div class="status-display" style="background: ${status.color}; color: white; padding: 8px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; text-align: center; min-width: 120px;">
                        ${status.name}
                    </div>
                    <div class="date-cell">${createdDate}</div>
                    <div class="items-count">üì¶ ${itemsCount}</div>
                    <div class="photos-count">üì∑ ${photosCount}</div>
                    <div class="date-cell">${updatedDate}</div>
                    <div class="actions">
                        <button class="action-btn" style="padding: 10px 18px; font-size: 14px; margin-right: 8px;" onclick="editOrder('${order.id}')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="action-btn" style="padding: 10px 18px; font-size: 14px;" onclick="showOrderDetails('${order.id}')">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                    </div>
                </div>
            `;
        }

        // Status editing is now handled through the edit modal
        // Function removed since status dropdowns are no longer used

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
        function editOrder(orderId) {
            const order = allOrders.find(o => o.id === orderId);
            if (!order) return;

            currentEditOrder = order;
            const country = order.country === 'china' ? '–ö–∏—Ç–∞–µ' : order.country === 'japan' ? '–Ø–ø–æ–Ω–∏–∏' : '—Å—Ç—Ä–∞–Ω–µ –≤—ã–∫—É–ø–∞';

            const form = document.getElementById('editForm');
            form.innerHTML = `
                <div class="form-group">
                    <label class="form-label">–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞</label>
                    <input type="text" class="form-input" id="editOrderNumber" 
                           value="${order.order_number || ''}" 
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä–æ—Ç–∫–∏–π –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 001, 002)">
                    <small style="color: #888; font-size: 12px;">ID —Å–∏—Å—Ç–µ–º—ã: ${order.id}</small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞</label>
                    <select class="form-select" id="editStatus" onchange="onStatusChange()">
                        ${Object.values(orderStatuses).map(s =>
                `<option value="${s.id}" ${s.id === order.status ? 'selected' : ''}>${s.name}</option>`
            ).join('')}
                    </select>
                    <small style="color: #888; font-size: 12px; margin-top: 5px; display: block;" id="statusDescription">
                        ${(orderStatuses[order.status] && orderStatuses[order.status].description) || ''}
                    </small>
                </div>
                
                <!-- –ü–æ–ª–µ –¥–ª—è –Ω–æ–º–µ—Ä–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –°–î–≠–ö) -->
                <div class="form-group" id="trackingGroup" style="display: ${order.status === 'cdek_shipping' ? 'block' : 'none'}">
                    <label class="form-label">–ù–æ–º–µ—Ä –Ω–∞–∫–ª–∞–¥–Ω–æ–π –°–î–≠–ö</label>
                    <input type="text" class="form-input" id="editTracking" 
                           value="${order.tracking_number || ''}" 
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –Ω–∞–∫–ª–∞–¥–Ω–æ–π –°–î–≠–ö">
                </div>
                
                <!-- –ü–æ–ª–µ –¥–ª—è —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç–∞ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ '–ù–∞ —Å–∫–ª–∞–¥–µ') -->
                <div class="form-group" id="photoReportGroup" style="display: ${order.status === 'at_warehouse_photo' ? 'block' : 'none'}">
                    <label class="form-label">–§–æ—Ç–æ–æ—Ç—á–µ—Ç —Å–æ —Å–∫–ª–∞–¥–∞ –≤ ${country}</label>
                    
                    <!-- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç—ã -->
                    ${order.photo_reports && order.photo_reports.length > 0 ? `
                        <div class="existing-photo-reports" style="margin-bottom: 15px;">
                            <h4 style="color: #2ECC71; margin: 0 0 10px 0;">üì∑ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç—ã</h4>
                            <div class="photo-reports-list">
                                ${order.photo_reports.map((report, reportIndex) => `
                                    <div class="photo-report-item" style="background: rgba(46,204,113,0.1); border: 1px solid rgba(46,204,113,0.3); padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                                        <div style="font-size: 12px; color: #888; margin-bottom: 8px;">
                                            ${new Date(report.timestamp || order.status_updated_at).toLocaleString('ru-RU')} - ${report.by || 'manager'}
                                        </div>
                                        <div class="photo-thumbnails" style="display: flex; flex-wrap: wrap; gap: 8px;">
                                            ${report.photos ? report.photos.map((photo, photoIndex) => `
                                                <div class="photo-thumbnail" style="position: relative; display: inline-block;">
                                                    <img src="${photo}" alt="–§–æ—Ç–æ–æ—Ç—á–µ—Ç ${reportIndex + 1}-${photoIndex + 1}" 
                                                         style="width: 80px; height: 80px; object-fit: cover; border-radius: 6px; border: 2px solid #2ECC71; cursor: pointer;"
                                                         onclick="openManagerPhotoModal('${photo}')">
                                                    <button class="delete-photo-btn" onclick="deleteExistingPhoto(${reportIndex}, ${photoIndex})" 
                                                            style="position: absolute; top: -5px; right: -5px; background: #E74C3C; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                        √ó
                                                    </button>
                                                    <div style="position: absolute; bottom: 2px; right: 2px; background: rgba(46,204,113,0.8); color: white; border-radius: 3px; padding: 2px 4px; font-size: 10px;">
                                                        ${photoIndex + 1}
                                                    </div>
                                                </div>
                                            `).join('') : ''}
                                        </div>
                                        <button class="delete-report-btn" onclick="deletePhotoReport(${reportIndex})" 
                                                style="background: #E74C3C; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin-top: 8px; cursor: pointer;">
                                            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤–µ—Å—å –æ—Ç—á–µ—Ç
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <!-- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ñ–æ—Ç–æ -->
                    <input type="file" class="form-input" id="photoReportInput" multiple accept="image/*" onchange="handlePhotoReportUpload()">
                    <small style="color: #888; font-size: 12px;">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–ª—è –æ—Ç—á–µ—Ç–∞</small>
                    <div id="photoReportPreview" style="margin-top: 10px;"></div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <textarea class="form-textarea" id="managerComment" 
                              placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ —Ç–µ–∫—É—â–µ–º —Å—Ç–∞—Ç—É—Å–µ –∑–∞–∫–∞–∑–∞"></textarea>
                    <small style="color: #888; font-size: 12px;">–≠—Ç–æ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –±—É–¥–µ—Ç –≤–∏–¥–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ –µ–≥–æ –∑–∞–∫–∞–∑–µ</small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
                    <textarea class="form-textarea" id="editNotes" 
                              placeholder="–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤">${order.notes || ''}</textarea>
                    <small style="color: #888; font-size: 12px;">–≠—Ç–∏ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º</small>
                </div>
                
                <!-- –ò—Å—Ç–æ—Ä–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
                ${order.manager_comments && order.manager_comments.length > 0 ? `
                <div class="form-group">
                    <label class="form-label">–ò—Å—Ç–æ—Ä–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</label>
                    <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 6px; max-height: 200px; overflow-y: auto;">
                        ${order.manager_comments.map(comment => `
                            <div style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <div style="font-size: 12px; color: #888; margin-bottom: 5px;">
                                    ${new Date(comment.timestamp).toLocaleString('ru-RU')} - ${comment.status} (${comment.by})
                                </div>
                                <div>${comment.comment}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
                
                <button class="save-btn" onclick="saveOrderChanges()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            `;

            document.getElementById('editModal').style.display = 'block';
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–∞
        function onStatusChange() {
            const statusSelect = document.getElementById('editStatus');
            const selectedStatus = statusSelect.value;
            const statusDescription = document.getElementById('statusDescription');
            const trackingGroup = document.getElementById('trackingGroup');
            const photoReportGroup = document.getElementById('photoReportGroup');

            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
            const status = orderStatuses[selectedStatus];
            if (status && statusDescription) {
                statusDescription.textContent = status.description || '';
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –Ω–æ–º–µ—Ä–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
            if (trackingGroup) {
                trackingGroup.style.display = selectedStatus === 'cdek_shipping' ? 'block' : 'none';
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç–∞
            if (photoReportGroup) {
                photoReportGroup.style.display = selectedStatus === 'at_warehouse_photo' ? 'block' : 'none';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–æ—Ç–æ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ (–¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞)
        function openManagerPhotoModal(photoUrl) {
            const modalHTML = `
                <div id="managerPhotoModal" class="modal" style="display: flex; background: rgba(0,0,0,0.9);">
                    <div class="photo-modal-content">
                        <div class="modal-header" style="background: transparent; border: none;">
                            <button class="close-btn" onclick="closeManagerPhotoModal()" style="color: white; font-size: 30px;">&times;</button>
                        </div>
                        <div class="modal-body" style="text-align: center; padding: 0;">
                            <img src="${photoUrl}" alt="–§–æ—Ç–æ–æ—Ç—á–µ—Ç" style="max-width: 100%; max-height: 70vh; object-fit: contain;">
                        </div>
                        <div class="modal-footer" style="text-align: center; padding-top: 15px;">
                            <button class="save-btn" onclick="closeManagerPhotoModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ñ–æ—Ç–æ
        function closeManagerPhotoModal() {
            const modal = document.getElementById('managerPhotoModal');
            if (modal) {
                modal.remove();
            }
        }

        // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        function safeCloseModal() {
            console.log('üõ°Ô∏è –ó–∞–ø—É—Å–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞...');

            try {
                // –ú–µ—Ç–æ–¥ 1: –ü—Ä–æ—Å—Ç–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ CSS
                const modalsToHide = document.querySelectorAll('.modal, #editModal');
                modalsToHide.forEach((modal, index) => {
                    try {
                        if (modal) {
                            modal.style.display = 'none';
                            modal.style.visibility = 'hidden';
                            console.log(`–°–∫—Ä—ã—Ç–æ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ ${index + 1}`);
                        }
                    } catch (hideError) {
                        console.log(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ ${index + 1}:`, hideError.message);
                    }
                });

                // –ú–µ—Ç–æ–¥ 2: –û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
                setTimeout(() => {
                    try {
                        const modalsToRemove = document.querySelectorAll('.modal, #editModal');
                        modalsToRemove.forEach((modal, index) => {
                            try {
                                if (modal && modal.parentNode) {
                                    modal.parentNode.removeChild(modal);
                                    console.log(`–£–¥–∞–ª–µ–Ω–æ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ ${index + 1} —á–µ—Ä–µ–∑ parentNode`);
                                }
                            } catch (removeError) {
                                console.log(`–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ ${index + 1}:`, removeError.message);
                            }
                        });
                    } catch (cleanupError) {
                        console.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –æ—á–∏—Å—Ç–∫–µ:', cleanupError.message);
                    }
                }, 100);

                console.log('‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
                return true;

            } catch (globalError) {
                console.error('üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞:', globalError.message);
                return false;
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ñ–æ—Ç–æ –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –æ—Ç—á–µ—Ç–∞ - –£–õ–¨–¢–†–ê-–ê–ì–†–ï–°–°–ò–í–ù–´–ô –ú–ï–¢–û–î
        async function deleteExistingPhoto(reportIndex, photoIndex) {
            console.log(`üî• –£–õ–¨–¢–†–ê-–ê–ì–†–ï–°–°–ò–í–ù–û–ï –£–î–ê–õ–ï–ù–ò–ï: –§–æ—Ç–æ ${photoIndex} –∏–∑ –æ—Ç—á–µ—Ç–∞ ${reportIndex}`);

            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Ñ–æ—Ç–æ –∏–∑ –æ—Ç—á–µ—Ç–∞?')) {
                try {
                    // –®–ê–ì 1: –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–ê–Ø –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–•
                    console.log('üì• –®–ê–ì 1: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö...');

                    const freshResponse = await fetch(`http://localhost:5000/api/orders/all?t=${Date.now()}&force=ultra&nocache=${Math.random()}`);
                    const freshData = await freshResponse.json();

                    if (freshData.status !== 'success') {
                        throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞');
                    }

                    const serverOrder = freshData.orders.find(o => o.id === currentEditOrder.id);
                    if (!serverOrder) {
                        throw new Error('–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞');
                    }

                    console.log('‚úÖ –®–ê–ì 1 –ó–ê–í–ï–†–®–ï–ù: –°–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã:', serverOrder.photo_reports);

                    // –®–ê–ì 2: –°–û–ó–î–ê–ù–ò–ï –ê–ë–°–û–õ–Æ–¢–ù–û –ù–û–í–û–ô –ö–û–ü–ò–ò –î–ê–ù–ù–´–•
                    console.log('üîÑ –®–ê–ì 2: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö...');

                    let newPhotoReports = [];
                    if (serverOrder.photo_reports && Array.isArray(serverOrder.photo_reports)) {
                        // –ì–ª—É–±–æ–∫–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –æ—Ç—á–µ—Ç–∞
                        newPhotoReports = serverOrder.photo_reports.map((report, idx) => {
                            if (idx === reportIndex) {
                                // –î–ª—è —É–¥–∞–ª—è–µ–º–æ–≥–æ –æ—Ç—á–µ—Ç–∞ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –º–∞—Å—Å–∏–≤ —Ñ–æ—Ç–æ –ë–ï–ó —É–¥–∞–ª—è–µ–º–æ–≥–æ
                                const newPhotos = [];
                                report.photos.forEach((photo, pIdx) => {
                                    if (pIdx !== photoIndex) {
                                        newPhotos.push(JSON.parse(JSON.stringify(photo)));
                                    }
                                });
                                return {
                                    ...JSON.parse(JSON.stringify(report)),
                                    photos: newPhotos
                                };
                            } else {
                                return JSON.parse(JSON.stringify(report));
                            }
                        });

                        // –£–¥–∞–ª—è–µ–º –ø—É—Å—Ç—ã–µ –æ—Ç—á–µ—Ç—ã
                        newPhotoReports = newPhotoReports.filter(report =>
                            report.photos && report.photos.length > 0
                        );
                    }

                    console.log(`‚úÖ –®–ê–ì 2 –ó–ê–í–ï–†–®–ï–ù: –û—Ç—á–µ—Ç–æ–≤ –±—ã–ª–æ ${(serverOrder.photo_reports || []).length}, —Å—Ç–∞–ª–æ ${newPhotoReports.length}`);

                    // –®–ê–ì 3: –£–õ–¨–¢–†–ê-–ê–ì–†–ï–°–°–ò–í–ù–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–ï–†–í–ï–†–ê
                    console.log('üí• –®–ê–ì 3: –£–ª—å—Ç—Ä–∞-–∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞...');

                    const ultraUpdateResponse = await fetch(`http://localhost:5000/api/orders/${currentEditOrder.id}/status?ultra_force=true&t=${Date.now()}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Cache-Control': 'no-cache, no-store, must-revalidate',
                            'Pragma': 'no-cache',
                            'Expires': '0'
                        },
                        body: JSON.stringify({
                            status: serverOrder.status,
                            order_number: serverOrder.order_number || '',
                            tracking_number: serverOrder.tracking_number || '',
                            notes: serverOrder.notes || '',
                            updated_by: 'manager_ultra_aggressive',
                            photo_reports: newPhotoReports,
                            // –£–õ–¨–¢–†–ê-–ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´
                            ultra_force: true,
                            force_update: true,
                            delete_operation: 'single_photo',
                            delete_details: {
                                report_index: reportIndex,
                                photo_index: photoIndex,
                                timestamp: Date.now(),
                                operation_id: Math.random().toString(36)
                            },
                            timestamp: Date.now()
                        })
                    });

                    const ultraUpdateData = await ultraUpdateResponse.json();

                    if (ultraUpdateData.status !== 'success') {
                        throw new Error(`–£–ª—å—Ç—Ä–∞-–∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–∞–ª–µ–Ω–æ: ${ultraUpdateData.message}`);
                    }

                    console.log('‚úÖ –®–ê–ì 3 –ó–ê–í–ï–†–®–ï–ù: –°–µ—Ä–≤–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ');

                    // –®–ê–ì 4: –°–ï–†–ò–Ø –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–´–• –ü–ï–†–ï–ó–ê–ì–†–£–ó–û–ö
                    console.log('üîÑ –®–ê–ì 4: –°–µ—Ä–∏—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–æ–∫...');

                    // –û–±–Ω—É–ª—è–µ–º –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    allOrders = [];
                    currentEditOrder = null;

                    // –¢—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –∞–±—Å–æ–ª—é—Ç–Ω–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
                    await loadAllOrders();
                    await new Promise(resolve => setTimeout(resolve, 300));
                    await loadAllOrders();
                    await new Promise(resolve => setTimeout(resolve, 300));
                    await loadAllOrders();

                    console.log('‚úÖ –®–ê–ì 4 –ó–ê–í–ï–†–®–ï–ù: –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω—ã');

                    // –®–ê–ì 5: –ë–ï–ó–û–ü–ê–°–ù–û–ï –ó–ê–ö–†–´–¢–ò–ï –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê
                    console.log('üßπ –®–ê–ì 5: –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞...');
                    safeCloseModal();

                    const updatedOrder = allOrders.find(o => o.id === serverOrder.id);
                    if (!updatedOrder) {
                        throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∑–∞–∫–∞–∑ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏');
                    }

                    console.log('‚úÖ –®–ê–ì 5 –ó–ê–í–ï–†–®–ï–ù: –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –∑–∞–∫—Ä—ã—Ç–æ');

                    // –®–ê–ì 6: –í–û–°–°–û–ó–î–ê–ù–ò–ï –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê
                    console.log('üî• –®–ê–ì 6: –í–æ—Å—Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞...');

                    await new Promise(resolve => setTimeout(resolve, 500));
                    editOrder(updatedOrder.id);

                    console.log('‚úÖ –®–ê–ì 6 –ó–ê–í–ï–†–®–ï–ù: –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤–æ—Å—Å–æ–∑–¥–∞–Ω–æ');

                    console.log('üéâ –£–õ–¨–¢–†–ê-–ê–ì–†–ï–°–°–ò–í–ù–û–ï –£–î–ê–õ–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û!');
                    alert('üî• –§–æ—Ç–æ –£–õ–¨–¢–†–ê-–ê–ì–†–ï–°–°–ò–í–ù–û –£–ù–ò–ß–¢–û–ñ–ï–ù–û!');

                } catch (error) {
                    console.error('üí• –û–®–ò–ë–ö–ê –£–õ–¨–¢–†–ê-–ê–ì–†–ï–°–°–ò–í–ù–û–ì–û –£–î–ê–õ–ï–ù–ò–Ø:', error);

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–∞ –ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —É—Å–ø–µ—à–Ω–æ–π
                    try {
                        console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–æ –ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —É—Å–ø–µ—à–Ω—ã–º...');

                        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
                        await loadAllOrders();

                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Å—Ç–∞–ª–∏—Å—å –ª–∏ —Ñ–æ—Ç–æ –≤ –æ—Ç—á–µ—Ç–µ
                        const checkOrder = allOrders.find(o => o.id === currentEditOrder.id);
                        if (checkOrder && checkOrder.photo_reports) {
                            const reportExists = checkOrder.photo_reports[reportIndex];
                            const photoExists = reportExists && reportExists.photos && reportExists.photos[photoIndex];

                            if (!photoExists) {
                                console.log('‚úÖ –£–î–ê–õ–ï–ù–ò–ï –§–ê–ö–¢–ò–ß–ï–°–ö–ò –£–°–ü–ï–®–ù–û! –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –æ—à–∏–±–∫—É...');

                                // –£—Å–ø–µ—à–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ, –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                                safeCloseModal();

                                setTimeout(() => {
                                    try {
                                        editOrder(checkOrder.id);
                                        alert('‚úÖ –§–æ—Ç–æ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ!');
                                    } catch (reopenError) {
                                        console.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞:', reopenError.message);
                                        alert('‚úÖ –§–æ—Ç–æ —É–¥–∞–ª–µ–Ω–æ! –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.');
                                    }
                                }, 500);

                                return; // –í—ã—Ö–æ–¥–∏–º, –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –æ—à–∏–±–∫—É
                            }
                        }

                        // –ï—Å–ª–∏ –¥–æ—à–ª–∏ —Å—é–¥–∞, —Ç–æ —É–¥–∞–ª–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ —É–¥–∞–ª–æ—Å—å
                        console.log('‚ùå –£–¥–∞–ª–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ —É–¥–∞–ª–æ—Å—å');
                        alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ñ–æ—Ç–æ: ' + error.message);

                    } catch (checkError) {
                        console.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —É–¥–∞–ª–µ–Ω–∏—è:', checkError.message);
                        alert('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ñ–æ—Ç–æ. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.');
                    }
                }
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ–≥–æ —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç–∞ - –£–õ–¨–¢–†–ê-–ê–ì–†–ï–°–°–ò–í–ù–´–ô –ú–ï–¢–û–î
        async function deletePhotoReport(reportIndex) {
            console.log(`üî• –£–õ–¨–¢–†–ê-–ê–ì–†–ï–°–°–ò–í–ù–û–ï –£–î–ê–õ–ï–ù–ò–ï –û–¢–ß–ï–¢–ê: –û—Ç—á–µ—Ç ${reportIndex}`);

            if (confirm('–£–¥–∞–ª–∏—Ç—å –≤–µ—Å—å —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç?')) {
                try {
                    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö
                    const ultraResponse = await fetch(`http://localhost:5000/api/orders/all?t=${Date.now()}&ultra=${Math.random()}`);
                    const ultraData = await ultraResponse.json();

                    if (ultraData.status !== 'success') {
                        throw new Error('–ü—Ä–æ–≤–∞–ª –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                    }

                    const serverOrder = ultraData.orders.find(o => o.id === currentEditOrder.id);
                    if (!serverOrder) {
                        throw new Error('–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    }

                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –º–∞—Å—Å–∏–≤ –æ—Ç—á–µ—Ç–æ–≤ –ë–ï–ó —É–¥–∞–ª—è–µ–º–æ–≥–æ
                    let newReports = [];
                    if (serverOrder.photo_reports && Array.isArray(serverOrder.photo_reports)) {
                        serverOrder.photo_reports.forEach((report, idx) => {
                            if (idx !== reportIndex) {
                                newReports.push(JSON.parse(JSON.stringify(report)));
                            }
                        });
                    }

                    console.log(`–û—Ç—á–µ—Ç–æ–≤ –±—ã–ª–æ ${(serverOrder.photo_reports || []).length}, —Å—Ç–∞–ª–æ ${newReports.length}`);

                    // –£–ª—å—Ç—Ä–∞-–∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞
                    const updateResponse = await fetch(`http://localhost:5000/api/orders/${currentEditOrder.id}/status?ultra_force=true&t=${Date.now()}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Cache-Control': 'no-cache, no-store, must-revalidate',
                            'Pragma': 'no-cache',
                            'Expires': '0'
                        },
                        body: JSON.stringify({
                            status: serverOrder.status,
                            order_number: serverOrder.order_number || '',
                            tracking_number: serverOrder.tracking_number || '',
                            notes: serverOrder.notes || '',
                            updated_by: 'manager_ultra_force',
                            photo_reports: newReports,
                            ultra_force: true,
                            force_update: true,
                            delete_operation: 'entire_report',
                            delete_details: {
                                report_index: reportIndex,
                                timestamp: Date.now(),
                                operation_id: Math.random().toString(36)
                            },
                            timestamp: Date.now()
                        })
                    });

                    const updateData = await updateResponse.json();
                    if (updateData.status !== 'success') {
                        throw new Error(`–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–∞–ª–µ–Ω–æ: ${updateData.message}`);
                    }

                    // –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                    allOrders = [];
                    currentEditOrder = null;

                    // –ß–µ—Ç—ã—Ä–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –∞–±—Å–æ–ª—é—Ç–Ω–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
                    for (let i = 0; i < 4; i++) {
                        await loadAllOrders();
                        await new Promise(resolve => setTimeout(resolve, 300));
                    }

                    // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                    console.log('üßπ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞...');
                    safeCloseModal();

                    // –ù–∞—Ö–æ–¥–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∑–∞–∫–∞–∑
                    const updatedOrder = allOrders.find(o => o.id === serverOrder.id);
                    if (!updatedOrder) {
                        throw new Error('–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∑–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    }

                    // –í–æ—Å—Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                    await new Promise(resolve => setTimeout(resolve, 800));
                    editOrder(updatedOrder.id);

                    console.log('üéâ –£–õ–¨–¢–†–ê-–ê–ì–†–ï–°–°–ò–í–ù–û–ï –£–î–ê–õ–ï–ù–ò–ï –û–¢–ß–ï–¢–ê –ó–ê–í–ï–†–®–ï–ù–û!');
                    alert('üî• –§–æ—Ç–æ–æ—Ç—á–µ—Ç –£–õ–¨–¢–†–ê-–ê–ì–†–ï–°–°–ò–í–ù–û –£–ù–ò–ß–¢–û–ñ–ï–ù!');

                } catch (error) {
                    console.error('üí• –û–®–ò–ë–ö–ê –£–õ–¨–¢–†–ê-–ê–ì–†–ï–°–°–ò–í–ù–û–ì–û –£–î–ê–õ–ï–ù–ò–Ø –û–¢–ß–ï–¢–ê:', error);

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–æ –ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —É—Å–ø–µ—à–Ω—ã–º
                    try {
                        console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É–¥–∞–ª–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞...');

                        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                        await loadAllOrders();

                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É–¥–∞–ª–∏–ª—Å—è –ª–∏ –æ—Ç—á–µ—Ç
                        const checkOrder = allOrders.find(o => o.id === currentEditOrder.id);
                        if (checkOrder) {
                            const reportStillExists = checkOrder.photo_reports && checkOrder.photo_reports[reportIndex];

                            if (!reportStillExists) {
                                console.log('‚úÖ –û–¢–ß–ï–¢ –§–ê–ö–¢–ò–ß–ï–°–ö–ò –£–î–ê–õ–ï–ù! –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –æ—à–∏–±–∫—É...');

                                // –£—Å–ø–µ—à–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ, –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                                safeCloseModal();

                                setTimeout(() => {
                                    try {
                                        editOrder(checkOrder.id);
                                        alert('‚úÖ –§–æ—Ç–æ–æ—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!');
                                    } catch (reopenError) {
                                        console.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–æ—Ç–∫—Ä—ã—Ç–∏–∏:', reopenError.message);
                                        alert('‚úÖ –§–æ—Ç–æ–æ—Ç—á–µ—Ç —É–¥–∞–ª–µ–Ω! –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.');
                                    }
                                }, 500);

                                return; // –í—ã—Ö–æ–¥–∏–º, –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –æ—à–∏–±–∫—É
                            }
                        }

                        // –ï—Å–ª–∏ –¥–æ—à–ª–∏ —Å—é–¥–∞, —Ç–æ —É–¥–∞–ª–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ —É–¥–∞–ª–æ—Å—å
                        console.log('‚ùå –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ —É–¥–∞–ª–æ—Å—å');
                        alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ—Ç—á–µ—Ç–∞: ' + error.message);

                    } catch (checkError) {
                        console.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:', checkError.message);
                        alert('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ—Ç—á–µ—Ç–∞. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.');
                    }
                }
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç–∞
        let photoReportFiles = [];

        function handlePhotoReportUpload() {
            const input = document.getElementById('photoReportInput');
            const preview = document.getElementById('photoReportPreview');

            if (input.files.length === 0) {
                preview.innerHTML = '';
                photoReportFiles = [];
                return;
            }

            photoReportFiles = [];
            preview.innerHTML = '';

            Array.from(input.files).forEach((file, index) => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        photoReportFiles.push({
                            name: file.name,
                            data: e.target.result
                        });

                        // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é —Ñ–æ—Ç–æ
                        const imgPreview = document.createElement('div');
                        imgPreview.style.cssText = 'display: inline-block; margin: 5px; position: relative;';
                        imgPreview.innerHTML = `
                            <img src="${e.target.result}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px; border: 2px solid #00DBFF;">
                            <div style="position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px;">
                                ${index + 1}
                            </div>
                        `;
                        preview.appendChild(imgPreview);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
        async function saveOrderChanges() {
            if (!currentEditOrder) return;

            const orderNumber = document.getElementById('editOrderNumber').value;
            const newStatus = document.getElementById('editStatus').value;
            const trackingNumber = document.getElementById('editTracking')?.value || '';
            const notes = document.getElementById('editNotes').value;
            const managerComment = document.getElementById('managerComment').value;

            try {
                // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
                const updateData = {
                    status: newStatus,
                    order_number: orderNumber,
                    tracking_number: trackingNumber,
                    notes: notes,
                    manager_comment: managerComment,
                    updated_by: 'manager'
                };

                // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç, –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å "–ù–∞ —Å–∫–ª–∞–¥–µ" –∏ –µ—Å—Ç—å —Ñ–æ—Ç–æ
                if (newStatus === 'at_warehouse_photo' && photoReportFiles.length > 0) {
                    updateData.photo_report = photoReportFiles.map(file => file.data);
                }

                const response = await fetch(`http://localhost:5000/api/orders/${currentEditOrder.id}/status`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updateData)
                });

                const data = await response.json();

                if (data.status === 'success') {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
                    const order = allOrders.find(o => o.id === currentEditOrder.id);
                    if (order) {
                        order.status = newStatus;
                        order.order_number = orderNumber;
                        order.tracking_number = trackingNumber;
                        order.notes = notes;
                        order.status_updated_at = new Date().toISOString();
                        order.status_updated_by = 'manager';

                        // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, –µ—Å–ª–∏ –µ—Å—Ç—å
                        if (managerComment) {
                            if (!order.manager_comments) order.manager_comments = [];
                            order.manager_comments.push({
                                comment: managerComment,
                                timestamp: new Date().toISOString(),
                                status: newStatus,
                                by: 'manager'
                            });
                        }

                        // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç, –µ—Å–ª–∏ –µ—Å—Ç—å
                        if (photoReportFiles.length > 0) {
                            if (!order.photo_reports) order.photo_reports = [];
                            order.photo_reports.push({
                                photos: photoReportFiles.map(file => file.data),
                                timestamp: new Date().toISOString(),
                                status: newStatus,
                                by: 'manager'
                            });
                        }
                    }

                    closeEditModal();
                    displayOrders(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
                    updateStats();

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                    let message = '–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!';
                    if (orderNumber) message += `\n–ü—Ä–∏—Å–≤–æ–µ–Ω –Ω–æ–º–µ—Ä: ${orderNumber}`;
                    if (managerComment) message += '\n–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ–±–∞–≤–ª–µ–Ω';
                    if (photoReportFiles.length > 0) message += `\n–§–æ—Ç–æ–æ—Ç—á–µ—Ç: ${photoReportFiles.length} —Ñ–æ—Ç–æ`;

                    alert(message);
                } else {
                    alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + data.message);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            currentEditOrder = null;
            photoReportFiles = []; // –û—á–∏—â–∞–µ–º —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        function showOrderDetails(orderId) {
            const order = allOrders.find(o => o.id === orderId);
            console.log('–û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞:', order);
            if (!order) return;

            // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–∫–∞–∑–∞
            const modalHTML = `
                <div id="orderViewModal" class="modal" style="display: flex;">
                    <div class="modal-content" style="max-width: 800px; width: 95%;">
                        <div class="modal-header">
                            <h2>${order.order_number ? `–ó–∞–∫–∞–∑ #${order.order_number}` : `–ó–∞–∫–∞–∑ ID: ${order.id}`}</h2>
                            <button class="close-btn" onclick="closeOrderViewModal()" title="–ó–∞–∫—Ä—ã—Ç—å (Esc)">&times;</button>
                        </div>
                        <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ -->
                            <div class="order-info-section" style="margin-bottom: 20px;">
                                <h3>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ</h3>
                                <div class="info-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                                    <div class="info-item">
                                        <strong>–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞:</strong> ${order.order_number || '–ù–µ –ø—Ä–∏—Å–≤–æ–µ–Ω'}
                                    </div>
                                    <div class="info-item">
                                        <strong>ID —Å–∏—Å—Ç–µ–º—ã:</strong> ${order.id}
                                    </div>
                                    <div class="info-item">
                                        <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> ${order.full_name || order.telegram_username || '–ù–µ —É–∫–∞–∑–∞–Ω'}
                                    </div>
                                    <div class="info-item">
                                        <strong>Telegram ID:</strong> ${order.telegram_user_id}
                                    </div>
                                    <div class="info-item">
                                        <strong>–°—Ç—Ä–∞–Ω–∞:</strong> ${order.country === 'china' ? '–ö–∏—Ç–∞–π' : order.country === 'japan' ? '–Ø–ø–æ–Ω–∏—è' : '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}
                                    </div>
                                    <div class="info-item">
                                        <strong>–°—Ç–∞—Ç—É—Å:</strong> ${(orderStatuses[order.status] && orderStatuses[order.status].name) || order.status}
                                    </div>
                                    <div class="info-item">
                                        <strong>–°–æ–∑–¥–∞–Ω:</strong> ${new Date(order.created_at).toLocaleString('ru-RU')}
                                    </div>
                                    <div class="info-item">
                                        <strong>–û–±–Ω–æ–≤–ª–µ–Ω:</strong> ${new Date(order.status_updated_at).toLocaleString('ru-RU')}
                                    </div>
                                    ${order.tracking_number ? `<div class="info-item">
                                        <strong>–¢—Ä–µ–∫-–Ω–æ–º–µ—Ä:</strong> ${order.tracking_number}
                                    </div>` : ''}
                                    ${order.notes ? `<div class="info-item" style="grid-column: 1 / -1;">
                                        <strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:</strong> ${order.notes}
                                    </div>` : ''}
                                </div>
                            </div>

                            <!-- –¢–æ–≤–∞—Ä—ã -->
                            <div class="order-items-section">
                                <h3>üì¶ –¢–æ–≤–∞—Ä—ã (${(order.items && order.items.length) || 0})</h3>
                                ${(order.items && order.items.length) ? order.items.map((item, index) => `
                                    <div class="item-card" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                                        <h4>–¢–æ–≤–∞—Ä ${index + 1}</h4>
                                        <div class="item-details" style="margin-bottom: 10px;">
                                            ${item.link_or_id ? `<div><strong>–°—Å—ã–ª–∫–∞/ID:</strong> <a href="${item.link_or_id}" target="_blank" style="color: #00DBFF;">${item.link_or_id}</a></div>` : ''}
                                            ${item.color ? `<div><strong>–¶–≤–µ—Ç:</strong> ${item.color}</div>` : ''}
                                            ${item.size ? `<div><strong>–†–∞–∑–º–µ—Ä:</strong> ${item.size}</div>` : ''}
                                            <div><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</strong> ${item.quantity || 1}</div>
                                            ${item.price ? `<div><strong>–¶–µ–Ω–∞:</strong> ${item.price} ¬•</div>` : ''}
                                            ${item.comment ? `<div><strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong> ${item.comment}</div>` : ''}
                                        </div>
                                        ${item.photos && item.photos.length > 0 ? `
                                            <div class="item-photos">
                                                <strong>–§–æ—Ç–æ (${item.photos.length}):</strong>
                                                <div class="photos-container" style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px;">
                                                    ${item.photos.map((photo, photoIndex) => `
                                                        <div class="photo-item" style="position: relative; display: inline-block;">
                                                            <img src="${photo}" alt="–§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞ ${photoIndex + 1}" 
                                                                 class="photo-preview"
                                                                 style="width: 120px; height: 120px; object-fit: cover; border-radius: 8px; border: 2px solid #00DBFF; cursor: pointer;"
                                                                 onclick="showPhotoWithActions('${photo}', 'order_${order.id}_item_${itemIndex}_photo_${photoIndex + 1}.jpg', '${order.id}', ${itemIndex})">
                                                            
                                                            <div class="photo-actions">
                                                                <button class="photo-action-btn download" 
                                                                        onclick="event.stopPropagation(); downloadPhoto('${photo}', 'order_${order.id}_item_${itemIndex}_photo_${photoIndex + 1}.jpg')"
                                                                        title="–°–∫–∞—á–∞—Ç—å —Ñ–æ—Ç–æ">
                                                                    üíæ
                                                                </button>
                                                                <button class="photo-action-btn enhance" 
                                                                        onclick="event.stopPropagation(); showPhotoEnhancer('${photo}', 'order_${order.id}_item_${itemIndex}_photo_${photoIndex + 1}.jpg')"
                                                                        title="–£–ª—É—á—à–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ">
                                                                    üé®
                                                                </button>
                                                            </div>
                                                            
                                                            <div style="position: absolute; top: 5px; left: 5px; background: rgba(0,0,0,0.7); color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px;">
                                                                ${photoIndex + 1}
                                                            </div>
                                                        </div>
                                                    `).join('')}
                                                </div>
                                            </div>
                                        ` : '<div><em>–§–æ—Ç–æ –Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω—ã</em></div>'}
                                    </div>
                                `).join('') : '<div><em>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</em></div>'}
                            </div>
                            
                            <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ -->
                            ${order.manager_comments && order.manager_comments.length > 0 ? `
                            <div class="manager-comments-section" style="margin-top: 20px;">
                                <h3>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</h3>
                                ${order.manager_comments.map(comment => `
                                    <div class="comment-card" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; margin-bottom: 10px; border-left: 4px solid #00DBFF;">
                                        <div style="font-size: 12px; color: #888; margin-bottom: 8px;">
                                            ${new Date(comment.timestamp).toLocaleString('ru-RU')} - ${(orderStatuses[comment.status] && orderStatuses[comment.status].name) || comment.status} (–æ—Ç ${comment.by})
                                        </div>
                                        <div style="color: #fff;">${comment.comment}</div>
                                    </div>
                                `).join('')}
                            </div>
                            ` : ''}
                            
                            <!-- –§–æ—Ç–æ–æ—Ç—á–µ—Ç—ã -->
                            ${order.photo_reports && order.photo_reports.length > 0 ? `
                            <div class="photo-reports-section" style="margin-top: 20px;">
                                <h3>üì∑ –§–æ—Ç–æ–æ—Ç—á–µ—Ç—ã –º–µ–Ω–µ–¥–∂–µ—Ä–∞</h3>
                                ${order.photo_reports.map((report, reportIndex) => `
                                    <div class="report-card" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #FF6B35;">
                                        <h4>–û—Ç—á–µ—Ç ${reportIndex + 1}</h4>
                                        <div style="font-size: 12px; color: #888; margin-bottom: 10px;">
                                            ${new Date(report.timestamp).toLocaleString('ru-RU')} - ${(orderStatuses[report.status] && orderStatuses[report.status].name) || report.status} (–æ—Ç ${report.by})
                                        </div>
                                        <div class="photos-container" style="display: flex; flex-wrap: wrap; gap: 10px;">
                                            ${report.photos.map((photo, photoIndex) => `
                                                <div class="photo-item" style="position: relative; display: inline-block;">
                                                    <img src="${photo}" alt="–§–æ—Ç–æ–æ—Ç—á–µ—Ç ${photoIndex + 1}" 
                                                         class="photo-preview"
                                                         style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px; border: 2px solid #FF6B35; cursor: pointer;"
                                                         onclick="showPhotoWithActions('${photo}', 'order_${order.id}_report_${reportIndex}_photo_${photoIndex + 1}.jpg', '${order.id}', 'report')">
                                                    
                                                    <div class="photo-actions">
                                                        <button class="photo-action-btn download" 
                                                                onclick="event.stopPropagation(); downloadPhoto('${photo}', 'order_${order.id}_report_${reportIndex}_photo_${photoIndex + 1}.jpg')"
                                                                title="–°–∫–∞—á–∞—Ç—å —Ñ–æ—Ç–æ">
                                                            üíæ
                                                        </button>
                                                        <button class="photo-action-btn enhance" 
                                                                onclick="event.stopPropagation(); showPhotoEnhancer('${photo}', 'order_${order.id}_report_${reportIndex}_photo_${photoIndex + 1}.jpg')"
                                                                title="–£–ª—É—á—à–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ">
                                                            üé®
                                                        </button>
                                                    </div>
                                                    
                                                    <div style="position: absolute; top: 5px; left: 5px; background: rgba(255,107,53,0.8); color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px;">
                                                        ${photoIndex + 1}
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            ` : ''}
                            
                            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ -->
                            <div class="manager-info" style="margin-top: 20px; padding: 15px; background: rgba(0,219,255,0.1); border-radius: 10px; border: 1px solid #00DBFF;">
                                <h4>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞</h4>
                                <p>–í—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã –≤—ã—à–µ. –ú–µ–Ω–µ–¥–∂–µ—Ä –º–æ–∂–µ—Ç –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —Ç–∞–±–ª–∏—Ü—É.</p>
                                <p><strong>–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤:</strong> ${order.total_items || (order.items && order.items.length) || 0}</p>
                                <p><strong>–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π:</strong> ${order.total_photos || (order.items ? order.items.reduce((sum, item) => sum + (item.photos ? item.photos.length : 0), 0) : 0)}</p>
                            </div>
                        </div>
                        <div class="modal-footer" style="display: flex; justify-content: space-between; align-items: center; padding-top: 15px; border-top: 1px solid #555;">
                            <button class="simple-button" onclick="closeOrderViewModal()" style="background: rgba(255,255,255,0.1);">
                                ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –∑–∞–∫–∞–∑–æ–≤
                            </button>
                            <button class="save-btn" onclick="closeOrderViewModal()">
                                ‚úì –ó–∞–∫—Ä—ã—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
            `;

            // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
            document.body.insertAdjacentHTML('beforeend', modalHTML);

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            const modal = document.getElementById('orderViewModal');
            if (modal) {
                modal.addEventListener('click', function (e) {
                    if (e.target === modal) {
                        closeOrderViewModal();
                    }
                });

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ –∫–ª–∞–≤–∏—à–µ Escape
                document.addEventListener('keydown', function (e) {
                    if (e.key === 'Escape') {
                        closeOrderViewModal();
                    }
                });
            }
        }

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–∫–∞–∑–∞
        function closeOrderViewModal() {
            const modal = document.getElementById('orderViewModal');
            if (modal) {
                modal.remove();
                // –£–¥–∞–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏—à–∏ Escape
                document.removeEventListener('keydown', function (e) {
                    if (e.key === 'Escape') {
                        closeOrderViewModal();
                    }
                });
            }
        }

        // –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ç–æ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        function openPhotoModal(photoUrl) {
            // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–∫–∞–∑–∞
            const orderModal = document.getElementById('orderViewModal');
            if (orderModal) {
                orderModal.style.display = 'none';
            }

            const photoModalHTML = `
                <div id="photoModal" class="modal" style="display: flex; background: rgba(0,0,0,0.9);">
                    <div class="photo-modal-content">
                        <div class="modal-header" style="background: transparent; border: none;">
                            <button class="close-btn" onclick="closePhotoModal()" style="color: white; font-size: 30px;">&times;</button>
                        </div>
                        <div class="modal-body" style="text-align: center; padding: 0;">
                            <img src="${photoUrl}" alt="–§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞" style="max-width: 100%; max-height: 70vh; object-fit: contain;">
                        </div>
                        <div class="modal-footer" style="text-align: right; padding-top: 15px;">
                            <button class="save-btn" onclick="closePhotoModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', photoModalHTML);
        }

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ñ–æ—Ç–æ –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∑–∞–∫–∞–∑—É
        function closePhotoModal() {
            const photoModal = document.getElementById('photoModal');
            if (photoModal) {
                photoModal.remove();
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–Ω–æ–≤–∞ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–∫–∞–∑–∞
            const orderModal = document.getElementById('orderViewModal');
            if (orderModal) {
                orderModal.style.display = 'flex';
            }
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤
        function filterOrders() {
            const statusFilter = document.getElementById('statusFilter').value;
            const userFilter = document.getElementById('userFilter').value;

            filteredOrders = allOrders.filter(order => {
                const statusMatch = !statusFilter || order.status === statusFilter;
                const userMatch = !userFilter || order.telegram_user_id === userFilter;
                return statusMatch && userMatch;
            });

            displayOrders();
            updateStats();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function updateUserFilter() {
            const userFilter = document.getElementById('userFilter');
            const users = [...new Set(allOrders.map(order => ({
                id: order.telegram_user_id,
                name: order.full_name || order.telegram_username || order.telegram_user_id
            })))];

            // –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ–ø—Ü–∏–∏ (–∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–π)
            while (userFilter.children.length > 1) {
                userFilter.removeChild(userFilter.lastChild);
            }

            users.forEach(user => {
                const option = document.createElement('option');
                option.value = user.id;
                option.textContent = user.name;
                userFilter.appendChild(option);
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            const stats = {};

            // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
            Object.values(orderStatuses).forEach(status => {
                stats[status.id] = filteredOrders.filter(order => order.status === status.id).length;
            });

            const totalOrders = filteredOrders.length;
            const totalItems = filteredOrders.reduce((sum, order) => sum + order.total_items, 0);
            const totalPhotos = filteredOrders.reduce((sum, order) => sum + order.total_photos, 0);

            const statsContainer = document.getElementById('statsContainer');
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalOrders}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalItems}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalPhotos}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.pending_check || 0}</div>
                    <div class="stat-label">–û–∂–∏–¥–∞—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏</div>
                </div>
            `;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
        function showError(message) {
            const container = document.getElementById('ordersContainer');
            container.innerHTML = `
                <div class="error">
                    <strong>–û—à–∏–±–∫–∞:</strong> ${message}
                    <br><br>
                    <button class="action-btn" onclick="loadAllOrders()">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                </div>
            `;
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –µ–≥–æ
        window.onclick = function (event) {
            const editModal = document.getElementById('editModal');
            const orderViewModal = document.getElementById('orderViewModal');

            if (event.target === editModal) {
                closeEditModal();
            } else if (event.target === orderViewModal) {
                closeOrderViewModal();
            }
        }

        // Live-reloading –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
        function initLiveReload() {
            let lastModified = {};

            async function checkForChanges() {
                try {
                    const filesToWatch = ['manager_orders.html', 'style.css', 'script.js'];

                    for (const file of filesToWatch) {
                        const response = await fetch(`http://localhost:8080/${file}?check=${Date.now()}`);
                        const lastModifiedHeader = response.headers.get('last-modified');

                        if (lastModifiedHeader && lastModified[file] && lastModified[file] !== lastModifiedHeader) {
                            console.log(`üîÑ –§–∞–π–ª ${file} –∏–∑–º–µ–Ω–∏–ª—Å—è, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É...`);
                            window.location.reload();
                            return;
                        }

                        if (lastModifiedHeader) {
                            lastModified[file] = lastModifiedHeader;
                        }
                    }
                } catch (error) {
                    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ñ–∞–π–ª–æ–≤
                }
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
            setInterval(checkForChanges, 2000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', async function () {
            console.log('üë®‚Äçüíº –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');

            await loadOrderStatuses();
            await loadAllOrders();

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º live-reloading –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
            initLiveReload();
        });

        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –¥–ª—è inline onclick handlers
        window.editOrder = editOrder;
        window.showOrderDetails = showOrderDetails;
        window.closeEditModal = closeEditModal;
        window.saveOrderChanges = saveOrderChanges;
        window.onStatusChange = onStatusChange;
        window.handlePhotoReportUpload = handlePhotoReportUpload;
        window.openManagerPhotoModal = openManagerPhotoModal;
        window.closeManagerPhotoModal = closeManagerPhotoModal;
        window.deleteExistingPhoto = deleteExistingPhoto;
        window.deletePhotoReport = deletePhotoReport;
        window.closeOrderViewModal = closeOrderViewModal;

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
        async function downloadPhoto(photoSrc, filename) {
            try {
                // –ï—Å–ª–∏ —ç—Ç–æ base64 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                if (photoSrc.startsWith('data:image/')) {
                    const link = document.createElement('a');
                    link.href = photoSrc;
                    link.download = filename || 'photo.jpg';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    return;
                }

                // –ï—Å–ª–∏ —ç—Ç–æ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                const response = await fetch(photoSrc);
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);

                const link = document.createElement('a');
                link.href = url;
                link.download = filename || 'photo.jpg';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                window.URL.revokeObjectURL(url);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–æ—Ç–æ:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function enhanceImage(imageSrc, options = {}) {
            return new Promise((resolve) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();

                img.onload = function () {
                    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
                    const scale = options.scale || 2;
                    canvas.width = img.width * scale;
                    canvas.height = img.height * scale;

                    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ
                    ctx.imageSmoothingEnabled = true;
                    ctx.imageSmoothingQuality = 'high';

                    // –†–∏—Å—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º —Ä–∞–∑–º–µ—Ä–æ–º
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const data = imageData.data;

                    // –£–ª—É—á—à–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ –∏ —è—Ä–∫–æ—Å—Ç–∏
                    const brightness = options.brightness || 1.1;
                    const contrast = options.contrast || 1.2;
                    const saturation = options.saturation || 1.1;

                    for (let i = 0; i < data.length; i += 4) {
                        // –ü—Ä–∏–º–µ–Ω—è–µ–º —è—Ä–∫–æ—Å—Ç—å
                        data[i] *= brightness;     // Red
                        data[i + 1] *= brightness; // Green  
                        data[i + 2] *= brightness; // Blue

                        // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–æ–Ω—Ç—Ä–∞—Å—Ç
                        data[i] = ((data[i] - 128) * contrast) + 128;
                        data[i + 1] = ((data[i + 1] - 128) * contrast) + 128;
                        data[i + 2] = ((data[i + 2] - 128) * contrast) + 128;

                        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è
                        data[i] = Math.max(0, Math.min(255, data[i]));
                        data[i + 1] = Math.max(0, Math.min(255, data[i + 1]));
                        data[i + 2] = Math.max(0, Math.min(255, data[i + 2]));
                    }

                    ctx.putImageData(imageData, 0, 0);

                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —É–ª—É—á—à–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞–∫ base64
                    const enhancedDataUrl = canvas.toDataURL('image/jpeg', 0.95);
                    resolve(enhancedDataUrl);
                };

                img.src = imageSrc;
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å —É–ª—É—á—à–µ–Ω–∏–µ–º —Ñ–æ—Ç–æ
        async function showPhotoEnhancer(photoSrc, filename) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';

            modal.innerHTML = `
                <div class="photo-modal-content">
                    <div class="modal-header">
                        <h3>üé® –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</h3>
                        <button class="close-btn" onclick="this.closest('.modal').remove()">&times;</button>
                    </div>
                    
                    <div class="enhance-preview">
                        <div>
                            <div class="enhance-label">–û—Ä–∏–≥–∏–Ω–∞–ª</div>
                            <img src="${photoSrc}" class="original" alt="–û—Ä–∏–≥–∏–Ω–∞–ª">
                        </div>
                        <div>
                            <div class="enhance-label">–£–ª—É—á—à–µ–Ω–Ω–æ–µ</div>
                            <img id="enhancedPreview" src="${photoSrc}" class="enhanced" alt="–£–ª—É—á—à–µ–Ω–Ω–æ–µ">
                        </div>
                    </div>
                    
                    <div class="enhance-controls">
                        <div class="form-group">
                            <label class="form-label">–Ø—Ä–∫–æ—Å—Ç—å: <span id="brightnessValue">1.1</span></label>
                            <input type="range" class="enhance-slider" id="brightnessSlider" 
                                   min="0.5" max="2" step="0.1" value="1.1">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">–ö–æ–Ω—Ç—Ä–∞—Å—Ç: <span id="contrastValue">1.2</span></label>
                            <input type="range" class="enhance-slider" id="contrastSlider" 
                                   min="0.5" max="3" step="0.1" value="1.2">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">–ù–∞—Å—ã—â–µ–Ω–Ω–æ—Å—Ç—å: <span id="saturationValue">1.1</span></label>
                            <input type="range" class="enhance-slider" id="saturationSlider" 
                                   min="0.5" max="2" step="0.1" value="1.1">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">–ú–∞—Å—à—Ç–∞–±: <span id="scaleValue">2</span>x</label>
                            <input type="range" class="enhance-slider" id="scaleSlider" 
                                   min="1" max="4" step="0.5" value="2">
                        </div>
                    </div>
                    
                    <div class="photo-modal-actions">
                        <button class="simple-button" onclick="applyEnhancement()">üé® –ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                        <button class="simple-button" onclick="downloadEnhanced()">üíæ –°–∫–∞—á–∞—Ç—å —É–ª—É—á—à–µ–Ω–Ω–æ–µ</button>
                        <button class="simple-button" onclick="resetEnhancement()">üîÑ –°–±—Ä–æ—Å</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            let currentEnhanced = photoSrc;

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–ª–∞–π–¥–µ—Ä–æ–≤
            const brightnessSlider = modal.querySelector('#brightnessSlider');
            const contrastSlider = modal.querySelector('#contrastSlider');
            const saturationSlider = modal.querySelector('#saturationSlider');
            const scaleSlider = modal.querySelector('#scaleSlider');

            const brightnessValue = modal.querySelector('#brightnessValue');
            const contrastValue = modal.querySelector('#contrastValue');
            const saturationValue = modal.querySelector('#saturationValue');
            const scaleValue = modal.querySelector('#scaleValue');

            const enhancedPreview = modal.querySelector('#enhancedPreview');

            function updateValues() {
                brightnessValue.textContent = brightnessSlider.value;
                contrastValue.textContent = contrastSlider.value;
                saturationValue.textContent = saturationSlider.value;
                scaleValue.textContent = scaleSlider.value;
            }

            brightnessSlider.oninput = updateValues;
            contrastSlider.oninput = updateValues;
            saturationSlider.oninput = updateValues;
            scaleSlider.oninput = updateValues;

            // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            window.applyEnhancement = async function () {
                const options = {
                    brightness: parseFloat(brightnessSlider.value),
                    contrast: parseFloat(contrastSlider.value),
                    saturation: parseFloat(saturationSlider.value),
                    scale: parseFloat(scaleSlider.value)
                };

                try {
                    enhancedPreview.style.opacity = '0.5';
                    currentEnhanced = await enhanceImage(photoSrc, options);
                    enhancedPreview.src = currentEnhanced;
                    enhancedPreview.style.opacity = '1';
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —É–ª—É—á—à–µ–Ω–∏—è:', error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–ª—É—á—à–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
                    enhancedPreview.style.opacity = '1';
                }
            };

            window.downloadEnhanced = function () {
                downloadPhoto(currentEnhanced, `enhanced_${filename || 'photo.jpg'}`);
            };

            window.resetEnhancement = function () {
                brightnessSlider.value = '1.1';
                contrastSlider.value = '1.2';
                saturationSlider.value = '1.1';
                scaleSlider.value = '2';
                updateValues();
                enhancedPreview.src = photoSrc;
                currentEnhanced = photoSrc;
            };

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            modal.onclick = function (e) {
                if (e.target === modal) {
                    modal.remove();
                }
            };
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Ñ–æ—Ç–æ —Å –¥–µ–π—Å—Ç–≤–∏—è–º–∏
        function showPhotoWithActions(photoSrc, filename, orderId, itemIndex) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';

            modal.innerHTML = `
                <div class="photo-modal-content">
                    <div class="modal-header">
                        <h3>üì∑ –ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</h3>
                        <button class="close-btn" onclick="this.closest('.modal').remove()">&times;</button>
                    </div>
                    
                    <img src="${photoSrc}" alt="–§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞" style="max-width: 100%; max-height: 60vh; object-fit: contain;">
                    
                    <div class="photo-modal-actions">
                        <button class="simple-button download" onclick="downloadPhoto('${photoSrc}', '${filename}')">
                            üíæ –°–∫–∞—á–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª
                        </button>
                        <button class="simple-button enhance" onclick="showPhotoEnhancer('${photoSrc}', '${filename}')">
                            üé® –£–ª—É—á—à–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ
                        </button>
                        <button class="simple-button" onclick="this.closest('.modal').remove()">
                            ‚ùå –ó–∞–∫—Ä—ã—Ç—å
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            modal.onclick = function (e) {
                if (e.target === modal) {
                    modal.remove();
                }
            };
        }

        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å
        window.downloadPhoto = downloadPhoto;
        window.enhanceImage = enhanceImage;
        window.showPhotoEnhancer = showPhotoEnhancer;
        window.showPhotoWithActions = showPhotoWithActions;

        // –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞–∑–∞–¥
        function goBack() {
            console.log('üîô –í–æ–∑–≤—Ä–∞—Ç –Ω–∞–∑–∞–¥');
            if (window.history.length > 1) {
                window.history.back();
            } else {
                window.location.href = 'index.html';
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        function handleImageLoad(img) {
            if (img && img.classList) {
                img.classList.remove("loading");
            }
        }
        
        function handleImageError(img, fallbackText) {
            if (img) {
                img.style.display = "none";
                const fallback = img.nextElementSibling;
                if (fallback && fallback.classList.contains("image-fallback")) {
                    fallback.style.display = "flex";
                    fallback.textContent = fallbackText;
                }
            }
        }
    </script>

    <!-- SVG Stylized Back Button -->
    <button class="svg-back-button show" onclick="goBack()" aria-label="–ù–∞–∑–∞–¥">
        <img src="img/back_button.svg" alt="–ù–∞–∑–∞–¥" class="back-button-svg" 
             onerror="handleImageError(this, '–ù–∞–∑–∞–¥')" 
             onload="handleImageLoad(this)">
    </button>
</body>

</html>